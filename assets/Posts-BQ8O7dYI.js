import{r as s,q as A,j as o,B as r,s as B,v as $,t as x,k as F,y as N,a3 as W,P as R,I as U,a6 as z}from"./vendor-C65ctaoV.js";import{D as G}from"./Delete-DyDZc2Gn.js";import{S as H}from"./Search-CITB2S1j.js";import{b as J,s as j}from"./index-I0dD487A.js";import{C as K}from"./ConfirmModal-o5Z1I_1A.js";import"./supabase-Cg6Q1mgr.js";const O=s.createContext({});function Q(){return s.useContext(O)}function oe(){const y=A(),{user:e}=J(),{siteProfile:l,loading:I}=Q(),[c,C]=s.useState([]),[d,h]=s.useState(!0),[a,v]=s.useState(""),[f,P]=s.useState(1),[D,b]=s.useState(0),[E,u]=s.useState(!1),[i,p]=s.useState(null),m=10;console.log("Component rendered with user details:",{userId:e==null?void 0:e.id,userEmail:e==null?void 0:e.email,userMetadata:e==null?void 0:e.user_metadata,siteProfileId:l==null?void 0:l.id,loading:d,postsLength:c.length});const T=async()=>{try{if(console.log("Fetching posts for user:",{userId:e==null?void 0:e.id,userEmail:e==null?void 0:e.email}),h(!0),!(e!=null&&e.id)){console.log("No user ID available"),h(!1);return}let t=j.from("posts").select("*",{count:"exact"}).eq("user_id",e.id).order("created_at",{ascending:!1});a&&(t=t.or(`title.ilike.%${a}%,content.ilike.%${a}%`));const n=(f-1)*m,g=n+m-1;t=t.range(n,g);const{data:S,count:_,error:w}=await t;if(w)throw w;console.log("Posts fetched:",S),C(S||[]),b(Math.ceil((_||0)/m))}catch(t){console.error("Error fetching posts:",t)}finally{h(!1)}};s.useEffect(()=>{console.log("useEffect triggered with:",{userId:e==null?void 0:e.id,hasUser:!!e,loading:d}),e!=null&&e.id&&T()},[e==null?void 0:e.id,f,a]);const k=t=>{v(t.target.value),P(1)},M=(t,n)=>{P(n)},q=t=>{p(t),u(!0)},L=async()=>{if(i)try{const{error:t}=await j.from("images").delete().eq("post_id",i.id);if(t)throw t;const{error:n}=await j.from("posts").delete().eq("id",i.id);if(n)throw n;C(c.filter(g=>g.id!==i.id)),u(!1),p(null)}catch(t){console.error("Error deleting post:",t)}};return d||I?o.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:o.jsx(B,{})}):o.jsxs($,{maxWidth:"lg",sx:{mt:4,mb:4},children:[o.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[o.jsx(x,{variant:"h4",component:"h1",children:"Manage Posts"}),o.jsx(F,{variant:"contained",color:"primary",onClick:()=>y("/create"),children:"Create Post"})]}),o.jsx(N,{fullWidth:!0,variant:"outlined",placeholder:"Search posts...",value:a,onChange:k,sx:{mb:4},InputProps:{startAdornment:o.jsx(W,{position:"start",children:o.jsx(H,{})})}}),c.map(t=>o.jsxs(R,{sx:{p:2,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs(r,{children:[o.jsx(x,{variant:"h6",component:"h2",sx:{cursor:"pointer"},onClick:()=>y(`/post/${t.id}`),children:t.title}),o.jsxs(x,{variant:"body2",color:"text.secondary",children:["Last updated: ",new Date(t.updated_at).toLocaleDateString()]})]}),o.jsx(r,{children:o.jsx(U,{onClick:()=>q(t),color:"error",children:o.jsx(G,{})})})]},t.id)),o.jsx(r,{sx:{display:"flex",justifyContent:"center",mt:4},children:o.jsx(z,{count:D,page:f,onChange:M,color:"primary"})}),o.jsx(K,{open:E,onClose:()=>{u(!1),p(null)},onConfirm:L,title:"Delete Post",content:"Are you sure you want to delete this post? This action cannot be undone."})]})}export{oe as default};
//# sourceMappingURL=Posts-BQ8O7dYI.js.map
