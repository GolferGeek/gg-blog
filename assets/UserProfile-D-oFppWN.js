import{r as a,j as e,h as S,B as n,k as c,z as U,l as E}from"./vendor-CLzwre8y.js";import{M as B}from"./MarkdownEditor-BeRdleL5.js";import{s as o}from"./index-CYMg94ex.js";import"./supabase-DTekwhgc.js";const W=()=>{const[g,p]=a.useState(""),[h,x]=a.useState(""),[d,j]=a.useState(""),[l,u]=a.useState(!1),[m,i]=a.useState("");a.useEffect(()=>{b()},[]);const b=async()=>{try{const{data:{user:r}}=await o.auth.getUser();if(!r)throw new Error("No user found");const{data:t,error:s}=await o.from("profiles").select("username, resume, logo").eq("id",r.id).single();if(s)throw s;t&&(p(t.username||""),x(t.resume||""),j(t.logo||""))}catch(r){console.error("Error fetching profile:",r.message),i("Error fetching profile")}},y=async r=>{try{u(!0);const t=r.target.files[0];if(!t)return;const f=`site-logo.${t.name.split(".").pop()}`;await o.storage.from("logos").remove([f]).catch(console.error);const{error:w}=await o.storage.from("logos").upload(f,t,{upsert:!0});if(w)throw w;const{data:{publicUrl:P}}=o.storage.from("logos").getPublicUrl(f);j(P),i("Logo uploaded successfully")}catch(t){console.error("Error uploading logo:",t.message),i("Error uploading logo")}finally{u(!1)}},v=async()=>{try{u(!0);const{data:{user:r}}=await o.auth.getUser();if(!r)throw new Error("No user found");const t={id:r.id,username:g,resume:h,logo:d,updated_at:new Date().toISOString()},{error:s}=await o.from("profiles").upsert(t);if(s)throw s;i("Profile updated successfully")}catch(r){console.error("Error updating profile:",r.message),i("Error updating profile")}finally{u(!1)}};return e.jsxs(S,{maxWidth:"md",children:[e.jsxs(n,{sx:{mt:4,mb:2},children:[e.jsx(c,{variant:"h4",component:"h1",gutterBottom:!0,children:"User Profile"}),m&&e.jsx(c,{color:m.includes("Error")?"error":"success",gutterBottom:!0,children:m})]}),e.jsxs(n,{component:"form",noValidate:!0,sx:{mt:1},children:[e.jsx(U,{margin:"normal",required:!0,fullWidth:!0,label:"Username",value:g,onChange:r=>p(r.target.value),disabled:l}),e.jsxs(n,{sx:{mt:2,mb:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Resume (Markdown)"}),e.jsx(B,{value:h,onChange:x})]}),e.jsxs(n,{sx:{mt:2,mb:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Logo"}),d&&e.jsx(n,{sx:{mb:2},children:e.jsx("img",{src:d,alt:"Profile logo",style:{maxWidth:"200px"}})}),e.jsxs(E,{variant:"contained",component:"label",disabled:l,children:["Upload Logo",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:y})]})]}),e.jsx(E,{fullWidth:!0,variant:"contained",onClick:v,disabled:l,sx:{mt:3,mb:2},children:l?"Saving...":"Save Profile"})]})]})};export{W as default};
//# sourceMappingURL=UserProfile-D-oFppWN.js.map
