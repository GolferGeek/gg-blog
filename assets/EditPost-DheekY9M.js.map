{"version":3,"file":"EditPost-DheekY9M.js","sources":["../../src/pages/EditPost.jsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { useParams, useNavigate } from 'react-router-dom'\nimport { supabase } from '../lib/supabase'\nimport { useAuth } from '../contexts/AuthContext'\nimport MDEditor from '@uiw/react-md-editor'\nimport ImageUpload from '../components/ImageUpload'\nimport {\n  Box,\n  TextField,\n  Button,\n  Typography,\n  Container,\n  Paper,\n  Alert,\n  Chip,\n  Stack,\n  Grid,\n  FormGroup,\n  FormControlLabel,\n  Checkbox,\n  CircularProgress\n} from '@mui/material'\n\nexport default function EditPost() {\n  const { id } = useParams()\n  const navigate = useNavigate()\n  const { user } = useAuth()\n  const defaultUserId = import.meta.env.VITE_DEFAULT_USER\n  const [title, setTitle] = useState('')\n  const [content, setContent] = useState('')\n  const [excerpt, setExcerpt] = useState('')\n  const [interests, setInterests] = useState([])\n  const [error, setError] = useState(null)\n  const [loading, setLoading] = useState(false)\n  const [tags, setTags] = useState([])\n  const [tagInput, setTagInput] = useState('')\n  const [tagSuggestions, setTagSuggestions] = useState([])\n  const [loadingSuggestions, setLoadingSuggestions] = useState(false)\n  const [images, setImages] = useState([])\n  const [loadingPost, setLoadingPost] = useState(true)\n\n  const availableInterests = [\n    { value: 'coder', label: 'Coder' },\n    { value: 'golfer', label: 'Golfer' },\n    { value: 'mentor', label: 'Mentor' },\n    { value: 'leader', label: 'Leader' }\n  ]\n\n  useEffect(() => {\n    fetchPost()\n    fetchAllTags()\n  }, [id])\n\n  async function fetchPost() {\n    try {\n      setLoadingPost(true)\n      const { data: post, error } = await supabase\n        .from('posts')\n        .select('*')\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (post) {\n        setTitle(post.title)\n        setContent(post.content)\n        setExcerpt(post.excerpt || '')\n        setInterests(post.interests || [])\n        setTags(post.tags ? JSON.parse(post.tags) : [])\n        setImages(post.images || [])\n      }\n    } catch (error) {\n      console.error('Error fetching post:', error)\n      setError('Error fetching post')\n    } finally {\n      setLoadingPost(false)\n    }\n  }\n\n  async function fetchAllTags() {\n    try {\n      setLoadingSuggestions(true)\n      const { data, error } = await supabase\n        .from('tags')\n        .select('name')\n        .or(`user_id.eq.${defaultUserId},user_id.eq.${user?.id}`)\n        .order('name')\n\n      if (error) throw error\n      setTagSuggestions(data.map(tag => tag.name))\n    } catch (error) {\n      console.error('Error fetching tags:', error)\n    } finally {\n      setLoadingSuggestions(false)\n    }\n  }\n\n  const handleTagInputChange = (e) => {\n    setTagInput(e.target.value)\n  }\n\n  const handleAddTag = async (event) => {\n    if (event.key === 'Enter') {\n      event.preventDefault()\n      const trimmedInput = event.target.value.trim().toLowerCase()\n      \n      if (trimmedInput && !tags.includes(trimmedInput)) {\n        try {\n          // First, add to tags table if it doesn't exist\n          const { error } = await supabase\n            .from('tags')\n            .insert([{ \n              name: trimmedInput,\n              user_id: user?.id || defaultUserId \n            }])\n\n          if (error) throw error\n          setTags([...tags, trimmedInput])\n          event.target.value = ''\n          await fetchAllTags()\n        } catch (error) {\n          console.error('Error adding tag:', error)\n        }\n      }\n    }\n  }\n\n  const handleTagSelect = (tagName) => {\n    if (!tags.includes(tagName)) {\n      setTags([...tags, tagName])\n    }\n    setTagInput('')\n  }\n\n  const removeTag = (tagToRemove) => {\n    setTags(tags.filter(tag => tag !== tagToRemove))\n  }\n\n  const handleImageUpload = (uploadedImages) => {\n    setImages(prev => [...prev, ...uploadedImages])\n  }\n\n  const handleRemoveImage = (imageUrl) => {\n    setImages(prev => prev.filter(img => img !== imageUrl))\n  }\n\n  async function handleSubmit(e) {\n    e.preventDefault()\n    if (!user) {\n      setError('You must be logged in to edit a post')\n      return\n    }\n\n    try {\n      setError(null)\n      setLoading(true)\n\n      const { error } = await supabase\n        .from('posts')\n        .update({\n          title,\n          content,\n          excerpt,\n          interests,\n          tags: JSON.stringify(tags),\n          images,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', id)\n\n      if (error) throw error\n\n      navigate(`/post/${id}`)\n    } catch (error) {\n      console.error('Error updating post:', error)\n      setError('Failed to update post')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const filteredSuggestions = tagSuggestions.filter(tag => \n    tag.toLowerCase().includes(tagInput.toLowerCase()) && \n    !tags.includes(tag)\n  )\n\n  if (loadingPost) {\n    return (\n      <Container maxWidth=\"md\" sx={{ mt: 4, textAlign: 'center' }}>\n        <CircularProgress />\n      </Container>\n    )\n  }\n\n  if (error) {\n    return (\n      <Container maxWidth=\"md\" sx={{ mt: 4 }}>\n        <Alert severity=\"error\">{error}</Alert>\n      </Container>\n    )\n  }\n\n  return (\n    <Container maxWidth=\"lg\" sx={{ mt: 4, mb: 4 }}>\n      <Paper sx={{ p: 4 }}>\n        <Typography variant=\"h4\" component=\"h1\" gutterBottom>\n          Edit Post\n        </Typography>\n\n        {error && (\n          <Alert severity=\"error\" sx={{ mb: 2 }}>\n            {error}\n          </Alert>\n        )}\n\n        <form onSubmit={handleSubmit}>\n          <Grid container spacing={3}>\n            <Grid item xs={12}>\n              <TextField\n                label=\"Title\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                required\n                fullWidth\n              />\n            </Grid>\n\n            <Grid item xs={12}>\n              <Typography variant=\"h6\" gutterBottom>\n                Content\n              </Typography>\n              <MDEditor\n                value={content}\n                onChange={setContent}\n                height={400}\n                preview=\"edit\"\n              />\n            </Grid>\n\n            <Grid item xs={12}>\n              <Typography variant=\"h6\" gutterBottom>\n                Tags\n              </Typography>\n              \n              <Box sx={{ mb: 2 }}>\n                <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                  Available Tags\n                </Typography>\n                <Stack direction=\"row\" spacing={1} sx={{ mb: 2, flexWrap: 'wrap', gap: 1 }}>\n                  {tagSuggestions\n                    .filter(tag => !tags.includes(tag))\n                    .map((tag) => (\n                      <Chip\n                        key={tag}\n                        label={tag}\n                        onClick={() => handleTagSelect(tag)}\n                        color=\"default\"\n                        variant=\"outlined\"\n                        sx={{ cursor: 'pointer' }}\n                      />\n                    ))}\n                </Stack>\n              </Box>\n\n              <Box sx={{ mb: 2 }}>\n                <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                  Selected Tags\n                </Typography>\n                <Stack direction=\"row\" spacing={1} sx={{ flexWrap: 'wrap', gap: 1 }}>\n                  {tags.map((tag, index) => (\n                    <Chip\n                      key={index}\n                      label={tag}\n                      onDelete={() => removeTag(tag)}\n                      color=\"primary\"\n                      variant=\"outlined\"\n                    />\n                  ))}\n                </Stack>\n              </Box>\n\n              <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                Add New Tag\n              </Typography>\n              <TextField\n                fullWidth\n                label=\"New Tag\"\n                value={tagInput}\n                onChange={handleTagInputChange}\n                onKeyDown={handleAddTag}\n                placeholder=\"Type a new tag and press Enter\"\n                helperText=\"Press Enter to add a new tag\"\n                size=\"small\"\n                margin=\"normal\"\n              />\n              {tagInput && filteredSuggestions.length > 0 && (\n                <Paper sx={{ mt: 1, maxHeight: 200, overflow: 'auto' }}>\n                  <Stack>\n                    {filteredSuggestions.map((suggestion) => (\n                      <Box\n                        key={suggestion}\n                        sx={{\n                          p: 1,\n                          cursor: 'pointer',\n                          '&:hover': {\n                            bgcolor: 'action.hover'\n                          }\n                        }}\n                        onClick={() => handleTagSelect(suggestion)}\n                      >\n                        <Typography variant=\"body2\">{suggestion}</Typography>\n                      </Box>\n                    ))}\n                  </Stack>\n                </Paper>\n              )}\n            </Grid>\n\n            <Grid item xs={12}>\n              <Typography variant=\"h6\" gutterBottom>\n                Images\n              </Typography>\n              <ImageUpload \n                onUpload={handleImageUpload}\n                onRemove={handleRemoveImage}\n                existingImages={images}\n              />\n            </Grid>\n\n            <Grid item xs={12}>\n              <Box sx={{ display: 'flex', gap: 2, justifyContent: 'flex-end' }}>\n                <Button\n                  variant=\"outlined\"\n                  onClick={() => navigate(`/post/${id}`)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  variant=\"contained\"\n                  disabled={loading}\n                >\n                  {loading ? 'Saving...' : 'Save Changes'}\n                </Button>\n              </Box>\n            </Grid>\n          </Grid>\n        </form>\n      </Paper>\n    </Container>\n  )\n}"],"names":["EditPost","id","useParams","navigate","useNavigate","user","useAuth","defaultUserId","title","setTitle","useState","content","setContent","excerpt","setExcerpt","interests","setInterests","error","setError","loading","setLoading","tags","setTags","tagInput","setTagInput","tagSuggestions","setTagSuggestions","loadingSuggestions","setLoadingSuggestions","images","setImages","loadingPost","setLoadingPost","useEffect","fetchPost","fetchAllTags","post","supabase","data","tag","handleTagInputChange","handleAddTag","event","trimmedInput","handleTagSelect","tagName","removeTag","tagToRemove","handleImageUpload","uploadedImages","prev","handleRemoveImage","imageUrl","img","handleSubmit","filteredSuggestions","Container","jsx","CircularProgress","Alert","Paper","Typography","jsxs","Grid","TextField","MDEditor","Box","Stack","Chip","index","suggestion","ImageUpload","Button"],"mappings":"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"}