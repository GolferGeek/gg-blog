import{D as Z,u as ee,r as s,j as t,h as f,x as te,y as q,P as N,k as n,G as l,z as U,B as x,S as j,E as _,m as $}from"./vendor-BfW8ubqa.js";import{a as re,s as h}from"./index-CQv7LMvD.js";import{E as se}from"./editor-By8XcRZL.js";import{I as ae}from"./ImageUpload-ClT2-ZJ6.js";import"./supabase-CI9plm6Z.js";import"./Delete-BImv3mU7.js";function ge(){const{id:c}=Z(),v=ee(),{user:i}=re(),S="19334a99-3c60-4731-85b9-a8b30edad1af",[y,w]=s.useState(""),[b,T]=s.useState(""),[O,R]=s.useState(""),[z,F]=s.useState([]),[d,u]=s.useState(null),[C,E]=s.useState(!1),[a,g]=s.useState([]),[m,I]=s.useState(""),[B,G]=s.useState([]),[oe,P]=s.useState(!1),[A,p]=s.useState([]),[J,W]=s.useState(!0);s.useEffect(()=>{H(),k()},[c]);async function H(){try{W(!0);const{data:e,error:r}=await h.from("posts").select("*").eq("id",c).single();if(r)throw r;e&&(w(e.title),T(e.content),R(e.excerpt||""),F(e.interests||[]),g(e.tags?JSON.parse(e.tags):[]),p(e.images||[]))}catch(e){console.error("Error fetching post:",e),u("Error fetching post")}finally{W(!1)}}async function k(){try{P(!0);const{data:e,error:r}=await h.from("tags").select("name").or(`user_id.eq.${S},user_id.eq.${i==null?void 0:i.id}`).order("name");if(r)throw r;G(e.map(o=>o.name))}catch(e){console.error("Error fetching tags:",e)}finally{P(!1)}}const K=e=>{I(e.target.value)},Y=async e=>{if(e.key==="Enter"){e.preventDefault();const r=e.target.value.trim().toLowerCase();if(r&&!a.includes(r))try{const{error:o}=await h.from("tags").insert([{name:r,user_id:(i==null?void 0:i.id)||S}]);if(o)throw o;g([...a,r]),e.target.value="",await k()}catch(o){console.error("Error adding tag:",o)}}},D=e=>{a.includes(e)||g([...a,e]),I("")},M=e=>{g(a.filter(r=>r!==e))},Q=e=>{p(r=>[...r,...e])},V=e=>{p(r=>r.filter(o=>o!==e))};async function X(e){if(e.preventDefault(),!i){u("You must be logged in to edit a post");return}try{u(null),E(!0);const{error:r}=await h.from("posts").update({title:y,content:b,excerpt:O,interests:z,tags:JSON.stringify(a),images:A,updated_at:new Date().toISOString()}).eq("id",c);if(r)throw r;v(`/post/${c}`)}catch(r){console.error("Error updating post:",r),u("Failed to update post")}finally{E(!1)}}const L=B.filter(e=>e.toLowerCase().includes(m.toLowerCase())&&!a.includes(e));return J?t.jsx(f,{maxWidth:"md",sx:{mt:4,textAlign:"center"},children:t.jsx(te,{})}):d?t.jsx(f,{maxWidth:"md",sx:{mt:4},children:t.jsx(q,{severity:"error",children:d})}):t.jsx(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:t.jsxs(N,{sx:{p:4},children:[t.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"Edit Post"}),d&&t.jsx(q,{severity:"error",sx:{mb:2},children:d}),t.jsx("form",{onSubmit:X,children:t.jsxs(l,{container:!0,spacing:3,children:[t.jsx(l,{item:!0,xs:12,children:t.jsx(U,{label:"Title",value:y,onChange:e=>w(e.target.value),required:!0,fullWidth:!0})}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Content"}),t.jsx(se,{value:b,onChange:T,height:400,preview:"edit"})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Tags"}),t.jsxs(x,{sx:{mb:2},children:[t.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Available Tags"}),t.jsx(j,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:B.filter(e=>!a.includes(e)).map(e=>t.jsx(_,{label:e,onClick:()=>D(e),color:"default",variant:"outlined",sx:{cursor:"pointer"}},e))})]}),t.jsxs(x,{sx:{mb:2},children:[t.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Selected Tags"}),t.jsx(j,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:a.map((e,r)=>t.jsx(_,{label:e,onDelete:()=>M(e),color:"primary",variant:"outlined"},r))})]}),t.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Add New Tag"}),t.jsx(U,{fullWidth:!0,label:"New Tag",value:m,onChange:K,onKeyDown:Y,placeholder:"Type a new tag and press Enter",helperText:"Press Enter to add a new tag",size:"small",margin:"normal"}),m&&L.length>0&&t.jsx(N,{sx:{mt:1,maxHeight:200,overflow:"auto"},children:t.jsx(j,{children:L.map(e=>t.jsx(x,{sx:{p:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>D(e),children:t.jsx(n,{variant:"body2",children:e})},e))})})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Images"}),t.jsx(ae,{onUpload:Q,onRemove:V,existingImages:A})]}),t.jsx(l,{item:!0,xs:12,children:t.jsxs(x,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[t.jsx($,{variant:"outlined",onClick:()=>v(`/post/${c}`),children:"Cancel"}),t.jsx($,{type:"submit",variant:"contained",disabled:C,children:C?"Saving...":"Save Changes"})]})})]})})]})})}export{ge as default};
//# sourceMappingURL=EditPost-DheekY9M.js.map
