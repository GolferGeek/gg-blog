{"version":3,"file":"UserProfile-D-oFppWN.js","sources":["../../src/pages/UserProfile.jsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { Box, TextField, Button, Typography, Container } from '@mui/material'\nimport MarkdownEditor from '../components/MarkdownEditor'\nimport { supabase } from '../lib/supabase'\n\nconst UserProfile = () => {\n  const [username, setUsername] = useState('')\n  const [resume, setResume] = useState('')\n  const [logo, setLogo] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [message, setMessage] = useState('')\n\n  useEffect(() => {\n    getProfile()\n  }, [])\n\n  const getProfile = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser()\n      if (!user) throw new Error('No user found')\n\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('username, resume, logo')\n        .eq('id', user.id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        setUsername(data.username || '')\n        setResume(data.resume || '')\n        setLogo(data.logo || '')\n      }\n    } catch (error) {\n      console.error('Error fetching profile:', error.message)\n      setMessage('Error fetching profile')\n    }\n  }\n\n  const uploadLogo = async (event) => {\n    try {\n      setLoading(true)\n      const file = event.target.files[0]\n      if (!file) return\n\n      const fileExt = file.name.split('.').pop()\n      const filePath = `site-logo.${fileExt}`\n\n      // Remove existing logo if any\n      await supabase.storage\n        .from('logos')\n        .remove([filePath])\n        .catch(console.error) // Ignore error if file doesn't exist\n\n      const { error: uploadError } = await supabase.storage\n        .from('logos')\n        .upload(filePath, file, { upsert: true })\n\n      if (uploadError) throw uploadError\n\n      const { data: { publicUrl } } = supabase.storage\n        .from('logos')\n        .getPublicUrl(filePath)\n\n      setLogo(publicUrl)\n      setMessage('Logo uploaded successfully')\n    } catch (error) {\n      console.error('Error uploading logo:', error.message)\n      setMessage('Error uploading logo')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const updateProfile = async () => {\n    try {\n      setLoading(true)\n      const { data: { user } } = await supabase.auth.getUser()\n      if (!user) throw new Error('No user found')\n\n      const updates = {\n        id: user.id,\n        username,\n        resume,\n        logo,\n        updated_at: new Date().toISOString(),\n      }\n\n      const { error } = await supabase\n        .from('profiles')\n        .upsert(updates)\n\n      if (error) throw error\n      setMessage('Profile updated successfully')\n    } catch (error) {\n      console.error('Error updating profile:', error.message)\n      setMessage('Error updating profile')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <Container maxWidth=\"md\">\n      <Box sx={{ mt: 4, mb: 2 }}>\n        <Typography variant=\"h4\" component=\"h1\" gutterBottom>\n          User Profile\n        </Typography>\n        {message && (\n          <Typography color={message.includes('Error') ? 'error' : 'success'} gutterBottom>\n            {message}\n          </Typography>\n        )}\n      </Box>\n\n      <Box component=\"form\" noValidate sx={{ mt: 1 }}>\n        <TextField\n          margin=\"normal\"\n          required\n          fullWidth\n          label=\"Username\"\n          value={username}\n          onChange={(e) => setUsername(e.target.value)}\n          disabled={loading}\n        />\n\n        <Box sx={{ mt: 2, mb: 2 }}>\n          <Typography variant=\"subtitle1\" gutterBottom>\n            Resume (Markdown)\n          </Typography>\n          <MarkdownEditor\n            value={resume}\n            onChange={setResume}\n          />\n        </Box>\n\n        <Box sx={{ mt: 2, mb: 2 }}>\n          <Typography variant=\"subtitle1\" gutterBottom>\n            Logo\n          </Typography>\n          {logo && (\n            <Box sx={{ mb: 2 }}>\n              <img src={logo} alt=\"Profile logo\" style={{ maxWidth: '200px' }} />\n            </Box>\n          )}\n          <Button\n            variant=\"contained\"\n            component=\"label\"\n            disabled={loading}\n          >\n            Upload Logo\n            <input\n              type=\"file\"\n              hidden\n              accept=\"image/*\"\n              onChange={uploadLogo}\n            />\n          </Button>\n        </Box>\n\n        <Button\n          fullWidth\n          variant=\"contained\"\n          onClick={updateProfile}\n          disabled={loading}\n          sx={{ mt: 3, mb: 2 }}\n        >\n          {loading ? 'Saving...' : 'Save Profile'}\n        </Button>\n      </Box>\n    </Container>\n  )\n}\n\nexport default UserProfile\n"],"names":["UserProfile","username","setUsername","useState","resume","setResume","logo","setLogo","loading","setLoading","message","setMessage","useEffect","getProfile","user","supabase","data","error","uploadLogo","event","file","filePath","uploadError","publicUrl","updateProfile","updates","jsxs","Container","Box","jsx","Typography","TextField","e","MarkdownEditor","Button"],"mappings":"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"}