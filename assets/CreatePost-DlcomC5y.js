import{u as Z,r as a,j as t,h as $,P as b,k as n,y as ee,G as i,z as y,H as te,J as re,K as ae,B as d,S as w,E as F,m as L}from"./vendor-BfW8ubqa.js";import{E as se}from"./editor-By8XcRZL.js";import{a as ne,s as g}from"./index-BwGAzuKD.js";import{I as oe}from"./ImageUpload-CL7cCO2z.js";import"./supabase-CI9plm6Z.js";import"./Delete-BImv3mU7.js";function he(){const C=Z(),{user:m}=ne(),[h,G]=a.useState(""),[x,N]=a.useState(""),[S,K]=a.useState(""),[p,R]=a.useState(["coder"]),[f,T]=a.useState(!1),[c,E]=a.useState([]),[I,l]=a.useState(""),[s,j]=a.useState([]),[u,v]=a.useState(""),[B,U]=a.useState([]),[ie,P]=a.useState(!1),q=[{value:"coder",label:"Coder"},{value:"golfer",label:"Golfer"},{value:"mentor",label:"Mentor"},{value:"aging",label:"Aging"}];a.useEffect(()=>{k()},[]);async function k(){try{P(!0);const{data:e,error:r}=await g.from("tags").select("name").order("name");if(r)throw r;U(e.map(o=>o.name))}catch(e){console.error("Error fetching tags:",e)}finally{P(!1)}}function z(e){R(r=>r.includes(e)?r.filter(o=>o!==e):[...r,e])}const H=e=>{v(e.target.value)},J=e=>{(e.key==="Enter"||e.key===",")&&(e.preventDefault(),_())},_=async()=>{const e=u.trim();if(e&&!s.includes(e))try{const{error:r}=await g.from("tags").upsert({name:e},{onConflict:"name"});if(r)throw r;j([...s,e]),v(""),await k()}catch(r){console.error("Error adding tag:",r),l("Failed to add tag")}},A=e=>{s.includes(e)||j([...s,e]),v("")},M=e=>{j(s.filter(r=>r!==e))},O=e=>{E(r=>[...r,...e])},Q=e=>{E(r=>r.filter(o=>o!==e))};async function V(e){if(e.preventDefault(),p.length===0){l("Please select at least one interest");return}if(!h||!x){l("Please fill in all required fields");return}T(!0),l("");try{const{data:r,error:o}=await g.from("posts").insert([{title:h,content:x,excerpt:S,interests:p,tags:JSON.stringify(s),images:c,user_id:m==null?void 0:m.id}]).select().single();if(o)throw o;if(c.length>0){const X=c.map(async Y=>{const{error:D}=await g.from("images").insert([{url:Y,post_id:r.id}]);if(D)throw D});await Promise.all(X)}C("/post/"+r.id)}catch(r){console.error("Error creating post:",r),l("Failed to create post. Please try again.")}finally{T(!1)}}const W=B.filter(e=>e.toLowerCase().includes(u.toLowerCase())&&!s.includes(e));return t.jsx($,{maxWidth:"lg",sx:{mt:4,mb:4},children:t.jsxs(b,{sx:{p:4},children:[t.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"Create New Post"}),I&&t.jsx(ee,{severity:"error",sx:{mb:2},children:I}),t.jsx("form",{onSubmit:V,children:t.jsxs(i,{container:!0,spacing:3,children:[t.jsx(i,{item:!0,xs:12,children:t.jsx(y,{label:"Title",value:h,onChange:e=>G(e.target.value),fullWidth:!0,required:!0,variant:"outlined"})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(y,{label:"Excerpt",value:S,onChange:e=>K(e.target.value),fullWidth:!0,multiline:!0,rows:2,variant:"outlined",helperText:"A brief summary of your post"})}),t.jsxs(i,{item:!0,xs:12,children:[t.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Content"}),t.jsx(b,{sx:{p:2},children:t.jsx(se,{value:x,onChange:N,preview:"edit",height:400,highlightEnable:!0,enableScroll:!0})})]}),t.jsxs(i,{item:!0,xs:12,children:[t.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Interests"}),t.jsx(te,{row:!0,children:q.map(e=>t.jsx(re,{control:t.jsx(ae,{checked:p.includes(e.value),onChange:()=>z(e.value)}),label:e.label},e.value))})]}),t.jsxs(i,{item:!0,xs:12,children:[t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Tags"}),t.jsxs(d,{sx:{mb:2},children:[t.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Available Tags"}),t.jsx(w,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:B.filter(e=>!s.includes(e)).map(e=>t.jsx(F,{label:e,onClick:()=>A(e),color:"default",variant:"outlined",sx:{cursor:"pointer"}},e))})]}),t.jsxs(d,{sx:{mb:2},children:[t.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Selected Tags"}),t.jsx(w,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:s.map((e,r)=>t.jsx(F,{label:e,onDelete:()=>M(e),color:"primary",variant:"outlined"},r))})]}),t.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Add New Tag"}),t.jsx(y,{fullWidth:!0,label:"New Tag",value:u,onChange:H,onKeyDown:J,placeholder:"Type a new tag and press Enter",helperText:"Press Enter or comma to add a new tag",size:"small",margin:"normal"}),u&&W.length>0&&t.jsx(b,{sx:{mt:1,maxHeight:200,overflow:"auto"},children:t.jsx(w,{children:W.map(e=>t.jsx(d,{sx:{p:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>A(e),children:t.jsx(n,{variant:"body2",children:e})},e))})})]}),t.jsxs(i,{item:!0,xs:12,children:[t.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Images"}),t.jsx(oe,{onUpload:O,onRemove:Q,existingImages:c})]}),t.jsx(i,{item:!0,xs:12,children:t.jsxs(d,{sx:{display:"flex",gap:2,mt:2},children:[t.jsx(L,{type:"submit",variant:"contained",color:"primary",disabled:f,children:f?"Creating...":"Create Post"}),t.jsx(L,{variant:"outlined",onClick:()=>C("/"),disabled:f,children:"Cancel"})]})})]})})]})})}export{he as default};
//# sourceMappingURL=CreatePost-DlcomC5y.js.map
