{"version":3,"file":"EditPost-BRLOdZDO.js","sources":["../../src/pages/EditPost.jsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { useParams, useNavigate } from 'react-router-dom'\nimport { supabase } from '../lib/supabase'\nimport { useAuth } from '../contexts/AuthContext'\nimport MDEditor from '@uiw/react-md-editor'\nimport ImageUpload from '../components/ImageUpload'\nimport {\n  Box,\n  TextField,\n  Button,\n  Typography,\n  Container,\n  Paper,\n  Alert,\n  Chip,\n  Stack,\n  Grid,\n  FormGroup,\n  FormControlLabel,\n  Checkbox,\n  CircularProgress\n} from '@mui/material'\n\nfunction EditPost() {\n  const { id } = useParams()\n  const navigate = useNavigate()\n  const { user } = useAuth()\n  const [title, setTitle] = useState('')\n  const [content, setContent] = useState('')\n  const [excerpt, setExcerpt] = useState('')\n  const [interests, setInterests] = useState([])\n  const [error, setError] = useState(null)\n  const [loading, setLoading] = useState(false)\n  const [tags, setTags] = useState([])\n  const [tagInput, setTagInput] = useState('')\n  const [tagSuggestions, setTagSuggestions] = useState([])\n  const [loadingSuggestions, setLoadingSuggestions] = useState(false)\n  const [images, setImages] = useState([])\n  const [loadingPost, setLoadingPost] = useState(true)\n\n  const availableInterests = [\n    { value: 'coder', label: 'Coder' },\n    { value: 'golfer', label: 'Golfer' },\n    { value: 'mentor', label: 'Mentor' },\n    { value: 'leader', label: 'Leader' }\n  ]\n\n  useEffect(() => {\n    fetchPost()\n    fetchAllTags()\n  }, [id])\n\n  async function fetchPost() {\n    try {\n      setLoadingPost(true)\n      const { data: post, error } = await supabase\n        .from('posts')\n        .select('*')\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (post) {\n        setTitle(post.title)\n        setContent(post.content)\n        setExcerpt(post.excerpt || '')\n        setInterests(post.interests || [])\n        setTags(post.tags ? JSON.parse(post.tags) : [])\n        setImages(post.images || [])\n      }\n    } catch (error) {\n      console.error('Error fetching post:', error)\n      setError('Error fetching post')\n    } finally {\n      setLoadingPost(false)\n    }\n  }\n\n  async function fetchAllTags() {\n    try {\n      setLoadingSuggestions(true)\n      const { data, error } = await supabase\n        .from('tags')\n        .select('name')\n        .order('name')\n\n      if (error) throw error\n\n      setTagSuggestions(data.map(tag => tag.name))\n    } catch (error) {\n      console.error('Error fetching tags:', error)\n    } finally {\n      setLoadingSuggestions(false)\n    }\n  }\n\n  const handleTagInputChange = (e) => {\n    setTagInput(e.target.value)\n  }\n\n  const handleTagInputKeyDown = (e) => {\n    if (e.key === 'Enter' || e.key === ',') {\n      e.preventDefault()\n      addTag()\n    }\n  }\n\n  const addTag = async () => {\n    const trimmedInput = tagInput.trim()\n    if (trimmedInput && !tags.includes(trimmedInput)) {\n      try {\n        const { error: tagError } = await supabase\n          .from('tags')\n          .upsert({ name: trimmedInput }, { onConflict: 'name' })\n\n        if (tagError) throw tagError\n\n        setTags([...tags, trimmedInput])\n        setTagInput('')\n        \n        await fetchAllTags()\n      } catch (error) {\n        console.error('Error adding tag:', error)\n        setError('Failed to add tag')\n      }\n    }\n  }\n\n  const handleTagSelect = (tagName) => {\n    if (!tags.includes(tagName)) {\n      setTags([...tags, tagName])\n    }\n    setTagInput('')\n  }\n\n  const removeTag = (tagToRemove) => {\n    setTags(tags.filter(tag => tag !== tagToRemove))\n  }\n\n  const handleImageUpload = (uploadedImages) => {\n    setImages(prev => [...prev, ...uploadedImages])\n  }\n\n  const handleRemoveImage = (imageUrl) => {\n    setImages(prev => prev.filter(img => img !== imageUrl))\n  }\n\n  async function handleSubmit(e) {\n    e.preventDefault()\n    if (!user) {\n      setError('You must be logged in to edit a post')\n      return\n    }\n\n    try {\n      setError(null)\n      setLoading(true)\n\n      const { error } = await supabase\n        .from('posts')\n        .update({\n          title,\n          content,\n          excerpt,\n          interests,\n          tags: JSON.stringify(tags),\n          images,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', id)\n\n      if (error) throw error\n\n      navigate(`/post/${id}`)\n    } catch (error) {\n      console.error('Error updating post:', error)\n      setError('Failed to update post')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const filteredSuggestions = tagSuggestions.filter(tag => \n    tag.toLowerCase().includes(tagInput.toLowerCase()) && \n    !tags.includes(tag)\n  )\n\n  if (loadingPost) {\n    return (\n      <Container maxWidth=\"md\" sx={{ mt: 4, textAlign: 'center' }}>\n        <CircularProgress />\n      </Container>\n    )\n  }\n\n  if (error) {\n    return (\n      <Container maxWidth=\"md\" sx={{ mt: 4 }}>\n        <Alert severity=\"error\">{error}</Alert>\n      </Container>\n    )\n  }\n\n  return (\n    <Container maxWidth=\"lg\" sx={{ mt: 4, mb: 4 }}>\n      <Paper sx={{ p: 4 }}>\n        <Typography variant=\"h4\" component=\"h1\" gutterBottom>\n          Edit Post\n        </Typography>\n\n        {error && (\n          <Alert severity=\"error\" sx={{ mb: 2 }}>\n            {error}\n          </Alert>\n        )}\n\n        <form onSubmit={handleSubmit}>\n          <Grid container spacing={3}>\n            <Grid item xs={12}>\n              <TextField\n                label=\"Title\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                required\n                fullWidth\n              />\n            </Grid>\n\n            <Grid item xs={12}>\n              <Typography variant=\"h6\" gutterBottom>\n                Content\n              </Typography>\n              <MDEditor\n                value={content}\n                onChange={setContent}\n                height={400}\n                preview=\"edit\"\n              />\n            </Grid>\n\n            <Grid item xs={12}>\n              <Typography variant=\"h6\" gutterBottom>\n                Tags\n              </Typography>\n              \n              <Box sx={{ mb: 2 }}>\n                <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                  Available Tags\n                </Typography>\n                <Stack direction=\"row\" spacing={1} sx={{ mb: 2, flexWrap: 'wrap', gap: 1 }}>\n                  {tagSuggestions\n                    .filter(tag => !tags.includes(tag))\n                    .map((tag) => (\n                      <Chip\n                        key={tag}\n                        label={tag}\n                        onClick={() => handleTagSelect(tag)}\n                        color=\"default\"\n                        variant=\"outlined\"\n                        sx={{ cursor: 'pointer' }}\n                      />\n                    ))}\n                </Stack>\n              </Box>\n\n              <Box sx={{ mb: 2 }}>\n                <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                  Selected Tags\n                </Typography>\n                <Stack direction=\"row\" spacing={1} sx={{ flexWrap: 'wrap', gap: 1 }}>\n                  {tags.map((tag, index) => (\n                    <Chip\n                      key={index}\n                      label={tag}\n                      onDelete={() => removeTag(tag)}\n                      color=\"primary\"\n                      variant=\"outlined\"\n                    />\n                  ))}\n                </Stack>\n              </Box>\n\n              <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                Add New Tag\n              </Typography>\n              <TextField\n                fullWidth\n                label=\"New Tag\"\n                value={tagInput}\n                onChange={handleTagInputChange}\n                onKeyDown={handleTagInputKeyDown}\n                placeholder=\"Type a new tag and press Enter\"\n                helperText=\"Press Enter or comma to add a new tag\"\n                size=\"small\"\n                margin=\"normal\"\n              />\n              {tagInput && filteredSuggestions.length > 0 && (\n                <Paper sx={{ mt: 1, maxHeight: 200, overflow: 'auto' }}>\n                  <Stack>\n                    {filteredSuggestions.map((suggestion) => (\n                      <Box\n                        key={suggestion}\n                        sx={{\n                          p: 1,\n                          cursor: 'pointer',\n                          '&:hover': {\n                            bgcolor: 'action.hover'\n                          }\n                        }}\n                        onClick={() => handleTagSelect(suggestion)}\n                      >\n                        <Typography variant=\"body2\">{suggestion}</Typography>\n                      </Box>\n                    ))}\n                  </Stack>\n                </Paper>\n              )}\n            </Grid>\n\n            <Grid item xs={12}>\n              <Typography variant=\"h6\" gutterBottom>\n                Images\n              </Typography>\n              <ImageUpload \n                onUpload={handleImageUpload}\n                onRemove={handleRemoveImage}\n                existingImages={images}\n              />\n            </Grid>\n\n            <Grid item xs={12}>\n              <Box sx={{ display: 'flex', gap: 2, justifyContent: 'flex-end' }}>\n                <Button\n                  variant=\"outlined\"\n                  onClick={() => navigate(`/post/${id}`)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  variant=\"contained\"\n                  disabled={loading}\n                >\n                  {loading ? 'Saving...' : 'Save Changes'}\n                </Button>\n              </Box>\n            </Grid>\n          </Grid>\n        </form>\n      </Paper>\n    </Container>\n  )\n}\n\nexport default EditPost"],"names":["EditPost","id","useParams","navigate","useNavigate","user","useAuth","title","setTitle","useState","content","setContent","excerpt","setExcerpt","interests","setInterests","error","setError","loading","setLoading","tags","setTags","tagInput","setTagInput","tagSuggestions","setTagSuggestions","loadingSuggestions","setLoadingSuggestions","images","setImages","loadingPost","setLoadingPost","useEffect","fetchPost","fetchAllTags","post","supabase","data","tag","handleTagInputChange","e","handleTagInputKeyDown","addTag","trimmedInput","tagError","handleTagSelect","tagName","removeTag","tagToRemove","handleImageUpload","uploadedImages","prev","handleRemoveImage","imageUrl","img","handleSubmit","filteredSuggestions","jsx","Container","CircularProgress","Alert","jsxs","Paper","Typography","Grid","TextField","MDEditor","Box","Stack","Chip","index","suggestion","ImageUpload","Button"],"mappings":"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"}