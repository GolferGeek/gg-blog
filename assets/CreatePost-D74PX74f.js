import{u as Z,r as s,j as t,h as ee,P as v,k as i,y as te,G as l,z as b,H as re,J as ae,K as se,B as d,S as y,E as _,m as q}from"./vendor-BfW8ubqa.js";import{E as ne}from"./editor-By8XcRZL.js";import{a as oe,s as g}from"./index-CQv7LMvD.js";import{I as ie}from"./ImageUpload-ClT2-ZJ6.js";import"./supabase-CI9plm6Z.js";import"./Delete-BImv3mU7.js";function xe(){const w=Z(),{user:n}=oe(),C="19334a99-3c60-4731-85b9-a8b30edad1af",[h,F]=s.useState(""),[m,G]=s.useState(""),[S,N]=s.useState(""),[x,U]=s.useState(["coder"]),[p,T]=s.useState(!1),[c,E]=s.useState([]),[I,u]=s.useState(""),[o,f]=s.useState([]),[j,B]=s.useState(""),[P,K]=s.useState([]),[le,k]=s.useState(!1),R=[{value:"coder",label:"Coder"},{value:"golfer",label:"Golfer"},{value:"mentor",label:"Mentor"},{value:"aging",label:"Aging"}];s.useEffect(()=>{A()},[]);async function A(){try{k(!0);const{data:e,error:r}=await g.from("tags").select("name").or(`user_id.eq.${C},user_id.eq.${n==null?void 0:n.id}`).order("name");if(r)throw r;K(e.map(a=>a.name))}catch(e){console.error("Error fetching tags:",e)}finally{k(!1)}}function z(e){U(r=>r.includes(e)?r.filter(a=>a!==e):[...r,e])}const H=e=>{B(e.target.value)},J=e=>{e.key==="Enter"&&(e.preventDefault(),$(e))},$=async e=>{const r=e.target.value.trim().toLowerCase();if(r&&!o.includes(r))try{const{error:a}=await g.from("tags").insert([{name:r,user_id:(n==null?void 0:n.id)||C}]);if(a)throw a;f([...o,r]),e.target.value="",await A()}catch(a){console.error("Error adding tag:",a)}},L=e=>{o.includes(e)||f([...o,e]),B("")},M=e=>{f(o.filter(r=>r!==e))},O=e=>{E(r=>[...r,...e])},Q=e=>{E(r=>r.filter(a=>a!==e))};async function V(e){if(e.preventDefault(),x.length===0){u("Please select at least one interest");return}if(!h||!m){u("Please fill in all required fields");return}T(!0),u("");try{const{data:r,error:a}=await g.from("posts").insert([{title:h,content:m,excerpt:S,interests:x,tags:JSON.stringify(o),images:c,user_id:n==null?void 0:n.id}]).select().single();if(a)throw a;if(c.length>0){const X=c.map(async Y=>{const{error:D}=await g.from("images").insert([{url:Y,post_id:r.id}]);if(D)throw D});await Promise.all(X)}w("/post/"+r.id)}catch(r){console.error("Error creating post:",r),u("Failed to create post. Please try again.")}finally{T(!1)}}const W=P.filter(e=>e.toLowerCase().includes(j.toLowerCase())&&!o.includes(e));return t.jsx(ee,{maxWidth:"lg",sx:{mt:4,mb:4},children:t.jsxs(v,{sx:{p:4},children:[t.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"Create New Post"}),I&&t.jsx(te,{severity:"error",sx:{mb:2},children:I}),t.jsx("form",{onSubmit:V,children:t.jsxs(l,{container:!0,spacing:3,children:[t.jsx(l,{item:!0,xs:12,children:t.jsx(b,{label:"Title",value:h,onChange:e=>F(e.target.value),fullWidth:!0,required:!0,variant:"outlined"})}),t.jsx(l,{item:!0,xs:12,children:t.jsx(b,{label:"Excerpt",value:S,onChange:e=>N(e.target.value),fullWidth:!0,multiline:!0,rows:2,variant:"outlined",helperText:"A brief summary of your post"})}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Content"}),t.jsx(v,{sx:{p:2},children:t.jsx(ne,{value:m,onChange:G,preview:"edit",height:400,highlightEnable:!0,enableScroll:!0})})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Interests"}),t.jsx(re,{row:!0,children:R.map(e=>t.jsx(ae,{control:t.jsx(se,{checked:x.includes(e.value),onChange:()=>z(e.value)}),label:e.label},e.value))})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"h6",gutterBottom:!0,children:"Tags"}),t.jsxs(d,{sx:{mb:2},children:[t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Available Tags"}),t.jsx(y,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:P.filter(e=>!o.includes(e)).map(e=>t.jsx(_,{label:e,onClick:()=>L(e),color:"default",variant:"outlined",sx:{cursor:"pointer"}},e))})]}),t.jsxs(d,{sx:{mb:2},children:[t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Selected Tags"}),t.jsx(y,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:o.map((e,r)=>t.jsx(_,{label:e,onDelete:()=>M(e),color:"primary",variant:"outlined"},r))})]}),t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Add New Tag"}),t.jsx(b,{fullWidth:!0,label:"New Tag",value:j,onChange:H,onKeyDown:J,placeholder:"Type a new tag and press Enter",helperText:"Press Enter to add a new tag",size:"small",margin:"normal"}),j&&W.length>0&&t.jsx(v,{sx:{mt:1,maxHeight:200,overflow:"auto"},children:t.jsx(y,{children:W.map(e=>t.jsx(d,{sx:{p:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>L(e),children:t.jsx(i,{variant:"body2",children:e})},e))})})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Images"}),t.jsx(ie,{onUpload:O,onRemove:Q,existingImages:c})]}),t.jsx(l,{item:!0,xs:12,children:t.jsxs(d,{sx:{display:"flex",gap:2,mt:2},children:[t.jsx(q,{type:"submit",variant:"contained",color:"primary",disabled:p,children:p?"Creating...":"Create Post"}),t.jsx(q,{variant:"outlined",onClick:()=>w("/"),disabled:p,children:"Cancel"})]})})]})})]})})}export{xe as default};
//# sourceMappingURL=CreatePost-D74PX74f.js.map
