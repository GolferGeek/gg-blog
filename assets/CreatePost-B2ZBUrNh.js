import{q as z,p as H,r as d,j as t,v as J,P as k,t as i,D as O,J as l,B as u,L as Q,y as h,K as V,O as X,Q as Y,S as f,G as A,k as L}from"./vendor-C65ctaoV.js";import{b as Z,s as x}from"./index-I0dD487A.js";import{M as ee,I as te}from"./MarkdownEditor-Csx3Eh72.js";import"./supabase-Cg6Q1mgr.js";import"./Delete-DyDZc2Gn.js";function oe(){var E;const j=z(),{state:a}=H(),{user:c}=Z(),b="19334a99-3c60-4731-85b9-a8b30edad1af",[m,v]=d.useState(!1),[w,y]=d.useState(null),[C,D]=d.useState([]),[p,_]=d.useState(""),[s,o]=d.useState({title:"",content:"",excerpt:"",interests:a!=null&&a.interest?[a.interest.name]:["coder"],tags:[],images:[],parent_id:((E=a==null?void 0:a.parentPost)==null?void 0:E.id)||null,arc_id:a!=null&&a.parentPost?a.arcId||a.parentPost.id:null}),W=[{value:"coder",label:"Coder"},{value:"golfer",label:"Golfer"},{value:"mentor",label:"Mentor"},{value:"aging",label:"Aging"}];d.useEffect(()=>{I()},[]);async function I(){try{const{data:e,error:r}=await x.from("tags").select("name").or(`user_id.eq.${b},user_id.eq.${c==null?void 0:c.id}`).order("name");if(r)throw r;D(e.map(n=>n.name))}catch(e){console.error("Error fetching tags:",e)}}function q(e){o(r=>r.interests.includes(e)?{...r,interests:r.interests.filter(n=>n!==e)}:{...r,interests:[...r.interests,e]})}const G=e=>{_(e.target.value)},U=e=>{e.key==="Enter"&&(e.preventDefault(),$(e))},$=async e=>{const r=e.target.value.trim().toLowerCase();if(r&&!s.tags.includes(r))try{const{error:n}=await x.from("tags").insert([{name:r,user_id:(c==null?void 0:c.id)||b}]);if(n)throw n;o(g=>({...g,tags:[...g.tags,r]})),e.target.value="",await I()}catch(n){console.error("Error adding tag:",n)}},T=e=>{s.tags.includes(e)||o(r=>({...r,tags:[...r.tags,e]})),_("")},F=e=>{o(r=>({...r,tags:r.tags.filter(n=>n!==e)}))},K=e=>{o(r=>({...r,images:[...r.images,...e]}))},M=e=>{o(r=>({...r,images:r.images.filter(n=>n!==e)}))},N=async e=>{e.preventDefault(),v(!0),y(null);try{const{data:r,error:n}=await x.from("posts").insert([{...s,user_id:c.id,parent_id:s.parent_id?parseInt(s.parent_id):null,arc_id:null}]).select().single();if(n)throw n;if(s.parent_id){const{data:g,error:S}=await x.from("posts").select("arc_id").eq("id",parseInt(s.parent_id)).single();if(S)throw S;const R=g.arc_id||parseInt(s.parent_id),{error:B}=await x.rpc("update_post_arc",{post_id:r.id,parent_post_id:parseInt(s.parent_id),arc_identifier:R});if(B)throw B}j(`/post/${r.id}`)}catch(r){y(r.message)}finally{v(!1)}},P=C.filter(e=>e.toLowerCase().includes(p.toLowerCase())&&!s.tags.includes(e));return t.jsx(J,{maxWidth:"lg",sx:{mt:4,mb:4},children:t.jsxs(k,{sx:{p:4},children:[t.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"Create New Post"}),w&&t.jsx(O,{severity:"error",sx:{mb:2},children:w}),t.jsx("form",{onSubmit:N,children:t.jsxs(l,{container:!0,spacing:3,children:[(a==null?void 0:a.parentPost)&&t.jsx(l,{item:!0,xs:12,children:t.jsx(u,{sx:{mb:2},children:t.jsxs(i,{variant:"body2",color:"text.secondary",children:["Creating child post for: ",t.jsx(Q,{to:`/post/${a.parentPost.id}`,style:{color:"inherit",textDecoration:"underline"},children:a.parentPost.title})]})})}),t.jsx(l,{item:!0,xs:12,children:t.jsx(h,{label:"Title",value:s.title,onChange:e=>o(r=>({...r,title:e.target.value})),fullWidth:!0,required:!0,variant:"outlined"})}),t.jsx(l,{item:!0,xs:12,children:t.jsx(h,{label:"Excerpt",value:s.excerpt,onChange:e=>o(r=>({...r,excerpt:e.target.value})),fullWidth:!0,multiline:!0,rows:2,variant:"outlined",helperText:"A brief summary of your post"})}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Content"}),t.jsx(ee,{value:s.content,onChange:e=>o(r=>({...r,content:e}))})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Interests"}),t.jsx(V,{row:!0,children:W.map(e=>t.jsx(X,{control:t.jsx(Y,{checked:s.interests.includes(e.value),onChange:()=>q(e.value)}),label:e.label},e.value))})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"h6",gutterBottom:!0,children:"Tags"}),t.jsxs(u,{sx:{mb:2},children:[t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Available Tags"}),t.jsx(f,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:C.filter(e=>!s.tags.includes(e)).map(e=>t.jsx(A,{label:e,onClick:()=>T(e),variant:"outlined",size:"small",sx:{cursor:"pointer"}},e))})]}),t.jsxs(u,{sx:{mb:2},children:[t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Selected Tags"}),t.jsx(f,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:s.tags.map((e,r)=>t.jsx(A,{label:e,onDelete:()=>F(e),color:"primary",variant:"outlined"},r))})]}),t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Add New Tag"}),t.jsx(h,{fullWidth:!0,label:"New Tag",value:p,onChange:G,onKeyDown:U,placeholder:"Type a new tag and press Enter",helperText:"Press Enter to add a new tag",size:"small",sx:{mt:2}}),p&&P.length>0&&t.jsx(k,{sx:{mt:1,maxHeight:200,overflow:"auto"},children:t.jsx(f,{children:P.map(e=>t.jsx(u,{sx:{p:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>T(e),children:t.jsx(i,{variant:"body2",children:e})},e))})})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Images"}),t.jsx(te,{onUpload:K,onRemove:M,existingImages:s.images})]}),t.jsx(l,{item:!0,xs:12,children:t.jsxs(u,{sx:{display:"flex",gap:2,mt:2},children:[t.jsx(L,{type:"submit",variant:"contained",color:"primary",disabled:m,children:m?"Creating...":"Create Post"}),t.jsx(L,{variant:"outlined",onClick:()=>j("/"),disabled:m,children:"Cancel"})]})})]})})]})})}export{oe as default};
//# sourceMappingURL=CreatePost-B2ZBUrNh.js.map
