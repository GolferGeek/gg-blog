import{f as F,j as e,P as M,B as n,v as O,k as i,w as L,I as R,r as a,x as _,y as w,z as q,m as D,D as z,u as N,h as v,S as P,E as A,L as $,F as W}from"./vendor-BfW8ubqa.js";import{E as G}from"./editor-By8XcRZL.js";import{a as I,s as g}from"./index-CQv7LMvD.js";import{f as B,C as J}from"./ConfirmModal-DRDLS1sq.js";import{D as T}from"./Delete-BImv3mU7.js";import{E as U}from"./Edit-Dqkav3Zm.js";import"./supabase-CI9plm6Z.js";const V=F(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");function H({comment:o,onDelete:s}){const{user:l}=I(),m=l&&l.id===o.user_id,c=o.user_email?o.user_email[0].toUpperCase():"?";return e.jsx(M,{elevation:0,sx:{p:2,mb:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(O,{sx:{bgcolor:"primary.main"},children:c}),e.jsxs(n,{sx:{flexGrow:1},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(n,{children:[e.jsx(i,{variant:"subtitle2",component:"span",children:o.user_email}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{ml:1},children:B(new Date(o.created_at),"MMM d, yyyy h:mm a")})]}),m&&e.jsx(L,{title:"Delete comment",children:e.jsx(R,{onClick:()=>s(o.id),size:"small",color:"error",children:e.jsx(T,{fontSize:"small"})})})]}),e.jsx(i,{variant:"body2",color:"text.primary",sx:{whiteSpace:"pre-wrap"},children:o.content})]})]})})}function K({postId:o}){const{user:s}=I(),[l,m]=a.useState([]),[c,h]=a.useState(""),[p,S]=a.useState(!0),[f,u]=a.useState(null),[x,y]=a.useState(!1);a.useEffect(()=>{j()},[o]);async function j(){try{u(null);const{data:r,error:t}=await g.from("comments").select("*, profiles(email)").eq("post_id",o).order("created_at",{ascending:!0});if(t)throw t;m(r.map(d=>{var b;return{...d,user_email:(b=d.profiles)==null?void 0:b.email}}))}catch(r){console.error("Error fetching comments:",r),u("Failed to load comments. Please try again.")}finally{S(!1)}}async function k(r){if(r.preventDefault(),!(!s||!c.trim())){y(!0),u(null);try{const{error:t}=await g.from("comments").insert([{content:c.trim(),post_id:o,user_id:s.id}]);if(t)throw t;h(""),await j()}catch(t){console.error("Error adding comment:",t),u("Failed to add comment. Please try again.")}finally{y(!1)}}}async function E(r){try{u(null);const{error:t}=await g.from("comments").delete().eq("id",r);if(t)throw t;m(l.filter(d=>d.id!==r))}catch(t){console.error("Error deleting comment:",t),u("Failed to delete comment. Please try again.")}}return p?e.jsx(n,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(_,{})}):e.jsxs(n,{sx:{mt:4},children:[e.jsxs(i,{variant:"h6",gutterBottom:!0,children:["Comments (",l.length,")"]}),f&&e.jsx(w,{severity:"error",sx:{mb:2},children:f}),s?e.jsxs(M,{component:"form",onSubmit:k,elevation:1,sx:{p:3,mb:4,display:"flex",flexDirection:"column",gap:2,backgroundColor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:2},children:[e.jsx(q,{multiline:!0,rows:3,value:c,onChange:r=>h(r.target.value),placeholder:"Write a comment...",variant:"outlined",fullWidth:!0,disabled:x,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"background.default","&:hover":{backgroundColor:"background.default","& .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main"}},"&.Mui-focused":{backgroundColor:"background.default","& .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main",borderWidth:2}}}}}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{type:"submit",variant:"contained",disabled:x||!c.trim(),endIcon:e.jsx(V,{}),sx:{px:3,py:1,borderRadius:2,textTransform:"none",fontWeight:500,"&:hover":{backgroundColor:"primary.dark"}},children:x?"Posting...":"Post Comment"})})]}):e.jsx(w,{severity:"info",sx:{mb:4},children:"Please log in to comment."}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:l.length>0?l.map(r=>e.jsx(H,{comment:r,onDelete:E},r.id)):e.jsx(i,{color:"text.secondary",align:"center",children:"No comments yet. Be the first to comment!"})})]})}function se(){const{id:o}=z(),[s,l]=a.useState(null),[m,c]=a.useState(!0),[h,p]=a.useState(null),S=N(),{user:f}=I(),[u,x]=a.useState(!1),y=f&&s&&f.id===s.user_id;a.useEffect(()=>{j()},[o]);async function j(){try{c(!0),p(null);const{data:r,error:t}=await g.from("posts").select(`
          *,
          tags
        `).eq("id",o).single();if(t)throw t;let d=[];try{if(r.tags){const C=JSON.parse(r.tags);d=Array.isArray(C)?C:[]}}catch(C){console.error("Error parsing tags:",C)}const b={...r,tags:d};l(b)}catch(r){console.error("Error fetching post:",r),p("Failed to load post. Please try again later.")}finally{c(!1)}}async function k(){var r;try{const{error:t}=await g.from("posts").delete().eq("id",o);if(t)throw t;const d=((r=s==null?void 0:s.interests)==null?void 0:r[0])||"coder";S(`/${d}`)}catch(t){console.error("Error deleting post:",t),p("Failed to delete post. Please try again."),x(!1)}}const E=()=>{x(!0)};return m?e.jsx(v,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(_,{})}):h?e.jsx(v,{maxWidth:"lg",sx:{mt:4},children:e.jsx(w,{severity:"error",children:h})}):s?e.jsxs(v,{maxWidth:"lg",sx:{mt:4,mb:8},children:[e.jsxs(M,{elevation:3,sx:{p:4},children:[e.jsxs(n,{sx:{mb:4},children:[e.jsx(i,{variant:"h3",component:"h1",gutterBottom:!0,children:s.title}),e.jsx(n,{sx:{mb:3,color:"text.secondary"},children:e.jsxs(i,{variant:"body2",children:["Posted on ",B(new Date(s.created_at),"MMMM d, yyyy")]})}),e.jsxs(P,{direction:"row",spacing:4,sx:{mb:3},children:[Array.isArray(s.interests)&&s.interests.length>0&&e.jsxs(n,{children:[e.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Categories"}),e.jsx(P,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:s.interests.map((r,t)=>e.jsx(A,{label:r,color:"secondary",sx:{borderRadius:"4px",fontWeight:500}},t))})]}),Array.isArray(s.tags)&&s.tags.length>0&&e.jsxs(n,{children:[e.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Tags"}),e.jsx(P,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:s.tags.map((r,t)=>e.jsx(A,{label:r,color:"primary",variant:"outlined",sx:{borderRadius:"4px","&:hover":{backgroundColor:"primary.light",color:"white"}}},t))})]})]}),y&&e.jsxs(n,{sx:{mt:3,display:"flex",gap:2},children:[e.jsx(D,{variant:"outlined",startIcon:e.jsx(U,{}),component:$,to:`/edit/${s.id}`,children:"Edit"}),e.jsx(D,{variant:"outlined",color:"error",startIcon:e.jsx(T,{}),onClick:E,children:"Delete"})]})]}),e.jsx(W,{sx:{my:3}}),e.jsx(n,{sx:{"& img":{maxWidth:"100%",height:"auto"}},children:e.jsx(G.Markdown,{source:s.content})}),e.jsx(W,{sx:{my:4}}),e.jsxs(n,{sx:{mt:4},children:[e.jsx(i,{variant:"h5",gutterBottom:!0,children:"Comments"}),e.jsx(K,{postId:s.id})]})]}),e.jsx(J,{open:u,onClose:()=>x(!1),onConfirm:k,title:"Delete Post",content:"Are you sure you want to delete this post? This action cannot be undone."})]}):e.jsx(v,{maxWidth:"lg",sx:{mt:4},children:e.jsx(w,{severity:"info",children:"Post not found"})})}export{se as default};
//# sourceMappingURL=ViewPost-Dnw94vqk.js.map
