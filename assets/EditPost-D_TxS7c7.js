import{F as Z,u as tt,r as s,j as e,h as f,y as et,E as D,P as L,k as n,U as o,w as F,B as g,S as j,v as N,m as U}from"./vendor-B9LkEojj.js";import{a as rt,s as x}from"./index-Dm5WVTMK.js";import{E as st}from"./editor-BjFYD_qO.js";import{I as at}from"./ImageUpload-DMun2jjI.js";import"./supabase-DqNG0bqa.js";import"./Delete-CHcx-bYn.js";function gt(){const{id:i}=Z(),v=tt(),{user:q}=rt(),[y,S]=s.useState(""),[w,b]=s.useState(""),[O,R]=s.useState(""),[J,K]=s.useState([]),[c,l]=s.useState(null),[T,E]=s.useState(!1),[a,d]=s.useState([]),[u,m]=s.useState(""),[C,$]=s.useState([]),[nt,I]=s.useState(!1),[B,h]=s.useState([]),[z,P]=s.useState(!0);s.useEffect(()=>{G(),k()},[i]);async function G(){try{P(!0);const{data:t,error:r}=await x.from("posts").select("*").eq("id",i).single();if(r)throw r;t&&(S(t.title),b(t.content),R(t.excerpt||""),K(t.interests||[]),d(t.tags?JSON.parse(t.tags):[]),h(t.images||[]))}catch(t){console.error("Error fetching post:",t),l("Error fetching post")}finally{P(!1)}}async function k(){try{I(!0);const{data:t,error:r}=await x.from("tags").select("name").order("name");if(r)throw r;$(t.map(p=>p.name))}catch(t){console.error("Error fetching tags:",t)}finally{I(!1)}}const H=t=>{m(t.target.value)},Y=t=>{(t.key==="Enter"||t.key===",")&&(t.preventDefault(),_())},_=async()=>{const t=u.trim();if(t&&!a.includes(t))try{const{error:r}=await x.from("tags").upsert({name:t},{onConflict:"name"});if(r)throw r;d([...a,t]),m(""),await k()}catch(r){console.error("Error adding tag:",r),l("Failed to add tag")}},W=t=>{a.includes(t)||d([...a,t]),m("")},M=t=>{d(a.filter(r=>r!==t))},Q=t=>{h(r=>[...r,...t])},V=t=>{h(r=>r.filter(p=>p!==t))};async function X(t){if(t.preventDefault(),!q){l("You must be logged in to edit a post");return}try{l(null),E(!0);const{error:r}=await x.from("posts").update({title:y,content:w,excerpt:O,interests:J,tags:JSON.stringify(a),images:B,updated_at:new Date().toISOString()}).eq("id",i);if(r)throw r;v(`/post/${i}`)}catch(r){console.error("Error updating post:",r),l("Failed to update post")}finally{E(!1)}}const A=C.filter(t=>t.toLowerCase().includes(u.toLowerCase())&&!a.includes(t));return z?e.jsx(f,{maxWidth:"md",sx:{mt:4,textAlign:"center"},children:e.jsx(et,{})}):c?e.jsx(f,{maxWidth:"md",sx:{mt:4},children:e.jsx(D,{severity:"error",children:c})}):e.jsx(f,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsxs(L,{sx:{p:4},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"Edit Post"}),c&&e.jsx(D,{severity:"error",sx:{mb:2},children:c}),e.jsx("form",{onSubmit:X,children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(F,{label:"Title",value:y,onChange:t=>S(t.target.value),required:!0,fullWidth:!0})}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Content"}),e.jsx(st,{value:w,onChange:b,height:400,preview:"edit"})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Tags"}),e.jsxs(g,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Available Tags"}),e.jsx(j,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:C.filter(t=>!a.includes(t)).map(t=>e.jsx(N,{label:t,onClick:()=>W(t),color:"default",variant:"outlined",sx:{cursor:"pointer"}},t))})]}),e.jsxs(g,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Selected Tags"}),e.jsx(j,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:a.map((t,r)=>e.jsx(N,{label:t,onDelete:()=>M(t),color:"primary",variant:"outlined"},r))})]}),e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Add New Tag"}),e.jsx(F,{fullWidth:!0,label:"New Tag",value:u,onChange:H,onKeyDown:Y,placeholder:"Type a new tag and press Enter",helperText:"Press Enter or comma to add a new tag",size:"small",margin:"normal"}),u&&A.length>0&&e.jsx(L,{sx:{mt:1,maxHeight:200,overflow:"auto"},children:e.jsx(j,{children:A.map(t=>e.jsx(g,{sx:{p:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>W(t),children:e.jsx(n,{variant:"body2",children:t})},t))})})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Images"}),e.jsx(at,{onUpload:Q,onRemove:V,existingImages:B})]}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(g,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(U,{variant:"outlined",onClick:()=>v(`/post/${i}`),children:"Cancel"}),e.jsx(U,{type:"submit",variant:"contained",disabled:T,children:T?"Saving...":"Save Changes"})]})})]})})]})})}export{gt as default};
//# sourceMappingURL=EditPost-D_TxS7c7.js.map
