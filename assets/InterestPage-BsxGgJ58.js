import{f as A,j as e,u as _,r as i,P as k,B as a,k as m,L as D,S as v,E as P,m as E,D as F,x as M,h as T,z as B,a4 as L}from"./vendor-BfW8ubqa.js";import{a as q,s as j}from"./index-CQv7LMvD.js";import{E as W}from"./editor-By8XcRZL.js";import{f as R,C as N}from"./ConfirmModal-DRDLS1sq.js";import"./supabase-CI9plm6Z.js";const $=A(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");function O({post:t,onDelete:g}){const{user:l}=q(),b=_(),[n,d]=i.useState(!1),[u,y]=i.useState(null),h=l&&l.id===t.user_id,w=s=>{if(!s)return null;const o=/!\[.*?\]\((.*?)\)/,c=s.match(o);return c?c[1]:null};i.useEffect(()=>{const s=w(t.content);s&&y(s)},[t.content]);async function C(){try{const{error:s}=await j.from("images").delete().eq("post_id",t.id);if(s)throw s;const{error:o}=await j.from("posts").delete().eq("id",t.id);if(o)throw o;g&&g(t.id),d(!1)}catch(s){console.error("Error deleting post:",s),alert("Error deleting post. Please try again.")}}const f=()=>{var o,c;switch((c=(o=t.interests)==null?void 0:o[0])==null?void 0:c.toLowerCase()){case"coder":return"/images/coder.jpg";case"golfer":return"/images/golfer.jpg";case"mentor":return"/images/mentor.jpg";case"aging":return"/images/aging.jpg";default:return"/images/coder.jpg"}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{elevation:3,sx:{p:2,width:"100%"},children:e.jsxs(a,{sx:{display:"flex",gap:3},children:[e.jsx(a,{component:"img",src:u||f(),alt:t.title,sx:{width:150,height:150,objectFit:"cover",borderRadius:1,flexShrink:0}}),e.jsxs(a,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs(a,{sx:{mb:1},children:[e.jsx(m,{variant:"h6",component:D,to:`/post/${t.id}`,sx:{textDecoration:"none",color:"inherit","&:hover":{color:"primary.main"}},children:t.title}),e.jsxs(a,{sx:{display:"flex",gap:2,alignItems:"center",mt:.5},children:[e.jsx(v,{direction:"row",spacing:1,children:t.interests.map(s=>e.jsx(P,{label:s,size:"small",color:"primary",variant:"outlined"},s))}),e.jsx(m,{variant:"body2",color:"text.secondary",children:R(new Date(t.created_at),"MMMM d, yyyy")})]})]}),t.tags&&t.tags.length>0&&e.jsx(v,{direction:"row",spacing:1,sx:{mt:1,mb:2,flexWrap:"wrap",gap:1},children:t.tags.map((s,o)=>e.jsx(P,{label:s,size:"small",color:"primary",variant:"outlined",sx:{borderRadius:"4px","&:hover":{backgroundColor:"primary.light",color:"white"}}},o))}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:t.excerpt||"No excerpt available"}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:"auto"},children:[e.jsx(E,{component:D,to:`/post/${t.id}`,variant:"contained",color:"primary",size:"small",children:"Read More"}),h&&e.jsxs(v,{direction:"row",spacing:1,children:[e.jsx(E,{onClick:()=>b(`/edit/${t.id}`),variant:"outlined",color:"primary",size:"small",children:"Edit"}),e.jsx(E,{onClick:()=>d(!0),variant:"outlined",color:"error",size:"small",children:"Delete"})]})]})]})]})}),e.jsx(N,{open:n,onClose:()=>d(!1),onConfirm:C,title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone."})]})}function Q(){const{interest:t}=F(),g=_(),{user:l}=q(),b="19334a99-3c60-4731-85b9-a8b30edad1af",[n,d]=i.useState(null),[u,y]=i.useState([]),[h,w]=i.useState(""),[C,f]=i.useState(!0);i.useEffect(()=>{s()},[t,l]),i.useEffect(()=>{n&&o()},[h,n]);async function s(){try{if(l){const{data:p,error:I}=await j.from("interests").select("*").eq("name",t).eq("user_id",l.id).single();if(!I&&p){d(p);return}}const{data:r,error:x}=await j.from("interests").select("*").eq("name",t).eq("user_id",b).single();if(x){console.error("Error fetching interest:",x),g("/");return}d(r)}catch(r){console.error("Error in fetchInterestData:",r),g("/")}}async function o(){try{f(!0);let r=j.from("posts").select(`
          *,
          tags
        `).contains("interests",[n.name]).order("created_at",{ascending:!1});h?(r=r.ilike("name",`%${h}%`),r=r.limit(10)):r=r.limit(4);const{data:x,error:p}=await r;if(p)throw p;const I=x.map(S=>({...S,tags:S.tags?JSON.parse(S.tags):[]}));y(I)}catch(r){console.error("Error fetching posts:",r),f(!1)}finally{f(!1)}}const c=async r=>{y(u.filter(x=>x.id!==r))},z=()=>n!=null&&n.image_path?n.image_path:"/images/coder.jpg";return n?e.jsxs(a,{children:[e.jsxs(a,{sx:{mb:6},children:[e.jsx(a,{sx:{position:"relative",height:"300px",overflow:"hidden"},children:e.jsx(a,{component:"img",src:z(),alt:n.title,sx:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsx(a,{sx:{textAlign:"center",bgcolor:"background.paper",py:4},children:e.jsx(m,{variant:"h2",component:"h1",gutterBottom:!0,children:n.title})})]}),e.jsxs(T,{maxWidth:"lg",children:[n.content&&e.jsx(k,{elevation:3,sx:{p:4,mb:4},children:e.jsx(W.Markdown,{source:n.content})}),e.jsxs(k,{elevation:3,sx:{p:4,mb:4},children:[e.jsx(B,{fullWidth:!0,variant:"outlined",placeholder:"Search posts...",value:h,onChange:r=>w(r.target.value),InputProps:{startAdornment:e.jsx(L,{position:"start",children:e.jsx($,{})})},sx:{mb:2}}),C?e.jsx(a,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(M,{})}):u.length>0?e.jsx(v,{spacing:4,children:u.map(r=>e.jsx(a,{children:e.jsx(O,{post:r,onDelete:c})},r.id))}):e.jsxs(a,{sx:{textAlign:"center",py:4},children:[e.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No posts found"}),e.jsx(m,{color:"text.secondary",paragraph:!0,children:"Try adjusting your search or check back later for new content."})]})]})]})]}):e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(M,{})})}export{Q as default};
//# sourceMappingURL=InterestPage-BsxGgJ58.js.map
