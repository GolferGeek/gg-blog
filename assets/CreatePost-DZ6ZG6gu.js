import{u as H,G as J,r as c,j as t,h as M,P as k,k as i,y as O,H as l,B as u,L as Q,z as h,J as V,K as X,O as Y,S as f,E as A,l as L}from"./vendor-CLzwre8y.js";import{E as Z}from"./editor-CmZuVxSC.js";import{a as ee,s as p}from"./index-BJ8jdmwE.js";import{I as te}from"./ImageUpload-BpAgjyel.js";import"./supabase-DTekwhgc.js";import"./Delete-BuOpn6KW.js";function le(){var S;const b=H(),{state:a}=J(),{user:d}=ee(),j="19334a99-3c60-4731-85b9-a8b30edad1af",[m,w]=c.useState(!1),[v,y]=c.useState(null),[C,D]=c.useState([]),[x,_]=c.useState(""),[s,o]=c.useState({title:"",content:"",excerpt:"",interests:a!=null&&a.interest?[a.interest.name]:["coder"],tags:[],images:[],parent_id:((S=a==null?void 0:a.parentPost)==null?void 0:S.id)||null,arc_id:a!=null&&a.parentPost?a.arcId||a.parentPost.id:null}),W=[{value:"coder",label:"Coder"},{value:"golfer",label:"Golfer"},{value:"mentor",label:"Mentor"},{value:"aging",label:"Aging"}];c.useEffect(()=>{I()},[]);async function I(){try{const{data:e,error:r}=await p.from("tags").select("name").or(`user_id.eq.${j},user_id.eq.${d==null?void 0:d.id}`).order("name");if(r)throw r;D(e.map(n=>n.name))}catch(e){console.error("Error fetching tags:",e)}}function q(e){o(r=>r.interests.includes(e)?{...r,interests:r.interests.filter(n=>n!==e)}:{...r,interests:[...r.interests,e]})}const G=e=>{_(e.target.value)},R=e=>{e.key==="Enter"&&(e.preventDefault(),U(e))},U=async e=>{const r=e.target.value.trim().toLowerCase();if(r&&!s.tags.includes(r))try{const{error:n}=await p.from("tags").insert([{name:r,user_id:(d==null?void 0:d.id)||j}]);if(n)throw n;o(g=>({...g,tags:[...g.tags,r]})),e.target.value="",await I()}catch(n){console.error("Error adding tag:",n)}},T=e=>{s.tags.includes(e)||o(r=>({...r,tags:[...r.tags,e]})),_("")},$=e=>{o(r=>({...r,tags:r.tags.filter(n=>n!==e)}))},z=e=>{o(r=>({...r,images:[...r.images,...e]}))},F=e=>{o(r=>({...r,images:r.images.filter(n=>n!==e)}))},K=async e=>{e.preventDefault(),w(!0),y(null);try{const{data:r,error:n}=await p.from("posts").insert([{...s,user_id:d.id,parent_id:s.parent_id?parseInt(s.parent_id):null,arc_id:null}]).select().single();if(n)throw n;if(s.parent_id){const{data:g,error:P}=await p.from("posts").select("arc_id").eq("id",parseInt(s.parent_id)).single();if(P)throw P;const N=g.arc_id||parseInt(s.parent_id),{error:B}=await p.rpc("update_post_arc",{post_id:r.id,parent_post_id:parseInt(s.parent_id),arc_identifier:N});if(B)throw B}b(`/post/${r.id}`)}catch(r){y(r.message)}finally{w(!1)}},E=C.filter(e=>e.toLowerCase().includes(x.toLowerCase())&&!s.tags.includes(e));return t.jsx(M,{maxWidth:"lg",sx:{mt:4,mb:4},children:t.jsxs(k,{sx:{p:4},children:[t.jsx(i,{variant:"h4",component:"h1",gutterBottom:!0,children:"Create New Post"}),v&&t.jsx(O,{severity:"error",sx:{mb:2},children:v}),t.jsx("form",{onSubmit:K,children:t.jsxs(l,{container:!0,spacing:3,children:[(a==null?void 0:a.parentPost)&&t.jsx(l,{item:!0,xs:12,children:t.jsx(u,{sx:{mb:2},children:t.jsxs(i,{variant:"body2",color:"text.secondary",children:["Creating child post for: ",t.jsx(Q,{to:`/post/${a.parentPost.id}`,style:{color:"inherit",textDecoration:"underline"},children:a.parentPost.title})]})})}),t.jsx(l,{item:!0,xs:12,children:t.jsx(h,{label:"Title",value:s.title,onChange:e=>o(r=>({...r,title:e.target.value})),fullWidth:!0,required:!0,variant:"outlined"})}),t.jsx(l,{item:!0,xs:12,children:t.jsx(h,{label:"Excerpt",value:s.excerpt,onChange:e=>o(r=>({...r,excerpt:e.target.value})),fullWidth:!0,multiline:!0,rows:2,variant:"outlined",helperText:"A brief summary of your post"})}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Content"}),t.jsx(u,{sx:{"& .w-md-editor":{margin:0,boxShadow:"none",border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:1,height:"1000px"},"& .wmde-markdown":{padding:"16px"},"& .w-md-editor-toolbar":{padding:"8px",borderBottom:"1px solid rgba(0, 0, 0, 0.1)"},"& .w-md-editor-content":{height:"calc(100% - 40px) !important"},"& .w-md-editor-input":{height:"100% !important"},"& .w-md-editor-text":{height:"100% !important"},"& .w-md-editor-text-input":{padding:"16px !important",height:"100% !important"},"& .w-md-editor-preview":{padding:"16px !important",height:"100% !important"}},children:t.jsx(Z,{value:s.content,onChange:e=>o(r=>({...r,content:e})),preview:"edit",highlightEnable:!1,enableScroll:!0})})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Interests"}),t.jsx(V,{row:!0,children:W.map(e=>t.jsx(X,{control:t.jsx(Y,{checked:s.interests.includes(e.value),onChange:()=>q(e.value)}),label:e.label},e.value))})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"h6",gutterBottom:!0,children:"Tags"}),t.jsxs(u,{sx:{mb:2},children:[t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Available Tags"}),t.jsx(f,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:C.filter(e=>!s.tags.includes(e)).map(e=>t.jsx(A,{label:e,onClick:()=>T(e),variant:"outlined",size:"small",sx:{cursor:"pointer"}},e))})]}),t.jsxs(u,{sx:{mb:2},children:[t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Selected Tags"}),t.jsx(f,{direction:"row",spacing:1,sx:{flexWrap:"wrap",gap:1},children:s.tags.map((e,r)=>t.jsx(A,{label:e,onDelete:()=>$(e),color:"primary",variant:"outlined"},r))})]}),t.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Add New Tag"}),t.jsx(h,{fullWidth:!0,label:"New Tag",value:x,onChange:G,onKeyDown:R,placeholder:"Type a new tag and press Enter",helperText:"Press Enter to add a new tag",size:"small",sx:{mt:2}}),x&&E.length>0&&t.jsx(k,{sx:{mt:1,maxHeight:200,overflow:"auto"},children:t.jsx(f,{children:E.map(e=>t.jsx(u,{sx:{p:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>T(e),children:t.jsx(i,{variant:"body2",children:e})},e))})})]}),t.jsxs(l,{item:!0,xs:12,children:[t.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Images"}),t.jsx(te,{onUpload:z,onRemove:F,existingImages:s.images})]}),t.jsx(l,{item:!0,xs:12,children:t.jsxs(u,{sx:{display:"flex",gap:2,mt:2},children:[t.jsx(L,{type:"submit",variant:"contained",color:"primary",disabled:m,children:m?"Creating...":"Create Post"}),t.jsx(L,{variant:"outlined",onClick:()=>b("/"),disabled:m,children:"Cancel"})]})})]})})]})})}export{le as default};
//# sourceMappingURL=CreatePost-DZ6ZG6gu.js.map
