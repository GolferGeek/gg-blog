import{f as F,j as e,P,B as n,v as A,k as d,w as L,I as z,r as a,x as _,y as C,z as O,m as k,D as T,u as q,h as b,S as N,E as R,L as M,F as I}from"./vendor-BfW8ubqa.js";import{E as $}from"./editor-By8XcRZL.js";import{a as D,s as y}from"./index-B83fT0FK.js";import{f as B,C as H}from"./ConfirmModal-DRDLS1sq.js";import{D as W}from"./Delete-BImv3mU7.js";import{E as G}from"./Edit-Dqkav3Zm.js";import"./supabase-CI9plm6Z.js";const U=F(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");function V({comment:s,onDelete:o}){const{user:i}=D(),m=i&&i.id===s.user_id,l=s.user_email?s.user_email[0].toUpperCase():"?";return e.jsx(P,{elevation:0,sx:{p:2,mb:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(A,{sx:{bgcolor:"primary.main"},children:l}),e.jsxs(n,{sx:{flexGrow:1},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(n,{children:[e.jsx(d,{variant:"subtitle2",component:"span",children:s.user_email}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{ml:1},children:B(new Date(s.created_at),"MMM d, yyyy h:mm a")})]}),m&&e.jsx(L,{title:"Delete comment",children:e.jsx(z,{onClick:()=>o(s.id),size:"small",color:"error",children:e.jsx(W,{fontSize:"small"})})})]}),e.jsx(d,{variant:"body2",color:"text.primary",sx:{whiteSpace:"pre-wrap"},children:s.content})]})]})})}function J({postId:s}){const{user:o}=D(),[i,m]=a.useState([]),[l,h]=a.useState(""),[f,v]=a.useState(!0),[p,c]=a.useState(null),[u,g]=a.useState(!1);a.useEffect(()=>{j()},[s]);async function j(){try{c(null);const{data:t,error:r}=await y.from("comments").select("*, profiles(email)").eq("post_id",s).order("created_at",{ascending:!0});if(r)throw r;m(t.map(x=>{var E;return{...x,user_email:(E=x.profiles)==null?void 0:E.email}}))}catch(t){console.error("Error fetching comments:",t),c("Failed to load comments. Please try again.")}finally{v(!1)}}async function w(t){if(t.preventDefault(),!(!o||!l.trim())){g(!0),c(null);try{const{error:r}=await y.from("comments").insert([{content:l.trim(),post_id:s,user_id:o.id}]);if(r)throw r;h(""),await j()}catch(r){console.error("Error adding comment:",r),c("Failed to add comment. Please try again.")}finally{g(!1)}}}async function S(t){try{c(null);const{error:r}=await y.from("comments").delete().eq("id",t);if(r)throw r;m(i.filter(x=>x.id!==t))}catch(r){console.error("Error deleting comment:",r),c("Failed to delete comment. Please try again.")}}return f?e.jsx(n,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(_,{})}):e.jsxs(n,{sx:{mt:4},children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:["Comments (",i.length,")"]}),p&&e.jsx(C,{severity:"error",sx:{mb:2},children:p}),o?e.jsxs(P,{component:"form",onSubmit:w,elevation:1,sx:{p:3,mb:4,display:"flex",flexDirection:"column",gap:2,backgroundColor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:2},children:[e.jsx(O,{multiline:!0,rows:3,value:l,onChange:t=>h(t.target.value),placeholder:"Write a comment...",variant:"outlined",fullWidth:!0,disabled:u,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"background.default","&:hover":{backgroundColor:"background.default","& .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main"}},"&.Mui-focused":{backgroundColor:"background.default","& .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main",borderWidth:2}}}}}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(k,{type:"submit",variant:"contained",disabled:u||!l.trim(),endIcon:e.jsx(U,{}),sx:{px:3,py:1,borderRadius:2,textTransform:"none",fontWeight:500,"&:hover":{backgroundColor:"primary.dark"}},children:u?"Posting...":"Post Comment"})})]}):e.jsx(C,{severity:"info",sx:{mb:4},children:"Please log in to comment."}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:i.length>0?i.map(t=>e.jsx(V,{comment:t,onDelete:S},t.id)):e.jsx(d,{color:"text.secondary",align:"center",children:"No comments yet. Be the first to comment!"})})]})}function re(){const{id:s}=T(),[o,i]=a.useState(null),[m,l]=a.useState(!0),[h,f]=a.useState(null),v=q(),{user:p}=D(),[c,u]=a.useState(!1),g=p&&o&&p.id===o.user_id;a.useEffect(()=>{j()},[s]);async function j(){try{l(!0),f(null);const{data:t,error:r}=await y.from("posts").select("*").eq("id",s).single();if(r)throw r;i(t)}catch(t){console.error("Error fetching post:",t),f("Failed to load post. Please try again later.")}finally{l(!1)}}async function w(){var t;try{const{error:r}=await y.from("posts").delete().eq("id",s);if(r)throw r;const x=((t=o==null?void 0:o.interests)==null?void 0:t[0])||"coder";v(`/${x}`)}catch(r){console.error("Error deleting post:",r),f("Failed to delete post. Please try again."),u(!1)}}const S=()=>{u(!0)};return m?e.jsx(b,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(_,{})}):h?e.jsx(b,{maxWidth:"lg",sx:{mt:4},children:e.jsx(C,{severity:"error",children:h})}):o?e.jsxs(b,{maxWidth:"lg",sx:{mt:4},children:[e.jsxs(P,{elevation:3,sx:{p:4},children:[e.jsxs(n,{sx:{mb:4},children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:o.title}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center",mb:2},children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:B(new Date(o.created_at),"MMMM d, yyyy")}),e.jsx(N,{direction:"row",spacing:1,children:o.interests.map(t=>e.jsx(R,{label:t,color:"primary",variant:"outlined",component:M,to:`/${t.toLowerCase()}`,clickable:!0},t))})]}),g&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(k,{startIcon:e.jsx(G,{}),variant:"outlined",component:M,to:`/edit/${o.id}`,sx:{mr:2},children:"Edit Post"}),e.jsx(k,{startIcon:e.jsx(W,{}),variant:"outlined",color:"error",onClick:S,children:"Delete Post"})]})]}),e.jsx(I,{sx:{my:3}}),e.jsx(n,{sx:{"& img":{maxWidth:"100%",height:"auto",maxHeight:"600px",display:"block",margin:"20px auto"}},"data-color-mode":"light",children:e.jsx($.Markdown,{source:o.content,style:{whiteSpace:"pre-wrap",background:"transparent",fontSize:"1.1rem",lineHeight:1.6}})}),e.jsx(I,{sx:{my:4}}),e.jsxs(n,{sx:{mt:4},children:[e.jsx(d,{variant:"h5",gutterBottom:!0,children:"Comments"}),e.jsx(J,{postId:o.id})]})]}),e.jsx(H,{open:c,onClose:()=>u(!1),onConfirm:w,title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone."})]}):e.jsx(b,{maxWidth:"lg",sx:{mt:4},children:e.jsx(C,{severity:"info",children:"Post not found"})})}export{re as default};
//# sourceMappingURL=ViewPost-xrpSGXgJ.js.map
