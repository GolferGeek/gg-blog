import{f as D,j as e,u as k,r as i,P as b,B as o,k as h,L as E,S as C,E as P,m as w,D as M,x as I,h as F,z as A,a4 as z}from"./vendor-BfW8ubqa.js";import{a as B,s as u}from"./index-B83fT0FK.js";import{E as L}from"./editor-By8XcRZL.js";import{f as T,C as _}from"./ConfirmModal-DRDLS1sq.js";import"./supabase-CI9plm6Z.js";const q=D(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");function R({post:r,onDelete:x}){const{user:n}=B(),f=k(),[m,c]=i.useState(!1),[l,p]=i.useState(null),j=n&&n.id===r.user_id,g=s=>{if(!s)return null;const a=/!\[.*?\]\((.*?)\)/,t=s.match(a);return t?t[1]:null};i.useEffect(()=>{const s=g(r.content);s&&p(s)},[r.content]);async function y(){try{const{error:s}=await u.from("images").delete().eq("post_id",r.id);if(s)throw s;const{error:a}=await u.from("posts").delete().eq("id",r.id);if(a)throw a;x&&x(r.id),c(!1)}catch(s){console.error("Error deleting post:",s),alert("Error deleting post. Please try again.")}}const v=()=>{var a,t;switch((t=(a=r.interests)==null?void 0:a[0])==null?void 0:t.toLowerCase()){case"coder":return"/images/coder.jpg";case"golfer":return"/images/golfer.jpg";case"mentor":return"/images/mentor.jpg";case"aging":return"/images/aging.jpg";default:return"/images/coder.jpg"}};return e.jsxs(e.Fragment,{children:[e.jsx(b,{elevation:3,sx:{p:2,width:"100%"},children:e.jsxs(o,{sx:{display:"flex",gap:3},children:[e.jsx(o,{component:"img",src:l||v(),alt:r.title,sx:{width:150,height:150,objectFit:"cover",borderRadius:1,flexShrink:0}}),e.jsxs(o,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs(o,{sx:{mb:1},children:[e.jsx(h,{variant:"h6",component:E,to:`/post/${r.id}`,sx:{textDecoration:"none",color:"text.primary","&:hover":{color:"primary.main"}},children:r.title}),e.jsxs(o,{sx:{display:"flex",gap:2,alignItems:"center",mt:.5},children:[e.jsx(C,{direction:"row",spacing:1,children:r.interests.map(s=>e.jsx(P,{label:s,size:"small",color:"primary",variant:"outlined"},s))}),e.jsx(h,{variant:"body2",color:"text.secondary",children:T(new Date(r.created_at),"MMMM d, yyyy")})]})]}),e.jsx(h,{variant:"body2",color:"text.secondary",sx:{mb:2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:r.excerpt}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:"auto"},children:[e.jsx(w,{component:E,to:`/post/${r.id}`,variant:"contained",color:"primary",size:"small",children:"Read More"}),j&&e.jsxs(C,{direction:"row",spacing:1,children:[e.jsx(w,{onClick:()=>f(`/edit/${r.id}`),variant:"outlined",color:"primary",size:"small",children:"Edit"}),e.jsx(w,{onClick:()=>c(!0),variant:"outlined",color:"error",size:"small",children:"Delete"})]})]})]})]})}),e.jsx(_,{open:m,onClose:()=>c(!1),onConfirm:y,title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone."})]})}function G(){const{interest:r}=M(),x=k(),[n,f]=i.useState(null),[m,c]=i.useState([]),[l,p]=i.useState(""),[j,g]=i.useState(!0);i.useEffect(()=>{y()},[r]),i.useEffect(()=>{n&&v()},[l,n]);async function y(){try{console.log("Fetching interest data for:",r);const{data:t,error:d}=await u.from("interests").select("*").eq("name",r).single();if(d){console.error("Error fetching interest:",d),x("/");return}console.log("Found interest data:",t),f(t)}catch(t){console.error("Error fetching interest data:",t),x("/")}}async function v(){try{g(!0);let t=u.from("posts").select("*").contains("interests",[n.name]).order("created_at",{ascending:!1});l?(t=t.ilike("name",`%${l}%`),t=t.limit(10)):t=t.limit(4);const{data:d,error:S}=await t;if(S)throw S;c(d)}catch(t){console.error("Error fetching posts:",t)}finally{g(!1)}}const s=async t=>{c(m.filter(d=>d.id!==t))},a=()=>n!=null&&n.image_path?n.image_path:"/images/coder.jpg";return n?e.jsxs(o,{children:[e.jsxs(o,{sx:{mb:6},children:[e.jsx(o,{sx:{position:"relative",height:"300px",overflow:"hidden"},children:e.jsx(o,{component:"img",src:a(),alt:n.title,sx:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsx(o,{sx:{textAlign:"center",bgcolor:"background.paper",py:4},children:e.jsx(h,{variant:"h2",component:"h1",gutterBottom:!0,children:n.title})})]}),e.jsxs(F,{maxWidth:"lg",children:[n.content&&e.jsx(b,{elevation:3,sx:{p:4,mb:4},children:e.jsx(L.Markdown,{source:n.content})}),e.jsxs(b,{elevation:3,sx:{p:4,mb:4},children:[e.jsx(A,{fullWidth:!0,variant:"outlined",placeholder:"Search posts...",value:l,onChange:t=>p(t.target.value),InputProps:{startAdornment:e.jsx(z,{position:"start",children:e.jsx(q,{})})},sx:{mb:2}}),j?e.jsx(o,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(I,{})}):m.length>0?e.jsx(C,{spacing:4,children:m.map(t=>e.jsx(o,{children:e.jsx(R,{post:t,onDelete:s})},t.id))}):e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(h,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No posts found"}),e.jsx(h,{color:"text.secondary",paragraph:!0,children:"Try adjusting your search or check back later for new content."})]})]})]})]}):e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(I,{})})}export{G as default};
//# sourceMappingURL=InterestPage-BiEubOH6.js.map
